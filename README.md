# bifana

The source code for http://bifana.info/

## Setup
Update the `JWT_SECRET` in `docker-compose.yml`.

## Run
Execute
```
make start
```

After the containers are up, execute the following:
```
curl --location --request POST 'http://host/api/init' \
     --header 'Authorization: Bearer TOKEN'
```
See "Get a token" section below to generate a `TOKEN`.

Finally, configure a new datasource in grafana:
 * host: http://influxdb:8086
 * database: bifana

You can import the example `dashboard.json` dashboard

## Get a token
Tokens are generated by the following:
```
curl --location --request POST 'http://host/api/token' \
     --header 'Content-Type: application/json' \
     --data-raw '{
         "username": "cpollet",
         "secret": "JWT_SECRET"
     }'
```
Make sure that you replace `JWT_SECRET` with the actual value defined in `docker-compose.yml`.

## Publish meaures
You'll need a valid TOKEN (see the "Get a token" section above).

Measures are inserted using the following:
```
curl --location --request POST 'http://host/api/measure' \
     --header 'Authorization: Bearer TOKEN' \
     --header 'Content-Type: application/json' \
     --data-raw '{
         "time": "2022-03-30T12:00:00",
         "weight": {
             "total": 13,
             "meat": 13
         }
     }'
```
Note that the `time` field is optional and the default value is the current date/time.